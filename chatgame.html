<!DOCTYPE html>
<html>
<head>
  <title>slup2</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background: #222;
    }
    canvas {
      display: block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
  </style>
</head>
<body>
<canvas id="screen"></canvas>
<script>
const GAME_WIDTH = 400;
const GAME_HEIGHT = 225;

const gameCanvas = document.createElement("canvas");
gameCanvas.width = GAME_WIDTH;
gameCanvas.height = GAME_HEIGHT;
const gameCtx = gameCanvas.getContext("2d", { alpha: false });
gameCtx.imageSmoothingEnabled = false;

const screenCanvas = document.getElementById("screen");
const screenCtx = screenCanvas.getContext("2d", { alpha: false });
screenCtx.imageSmoothingEnabled = false;

function resizeCanvas() {
  screenCanvas.width = window.innerWidth;
  screenCanvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// Player
let player = { x: 50, y: 50, width: 4, height: 4, color: [0, 255, 0] };

// Input
let keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

// Pixel buffer
let buffer = gameCtx.createImageData(GAME_WIDTH, GAME_HEIGHT);
let data = buffer.data;

function clearBuffer(r=34,g=34,b=34){
  for(let i=0;i<data.length;i+=4){
    data[i]=r; data[i+1]=g; data[i+2]=b; data[i+3]=255;
  }
}

function setPixel(x,y,r,g,b,a=255){
  if(x<0||y<0||x>=GAME_WIDTH||y>=GAME_HEIGHT) return;
  const i=(y*GAME_WIDTH+x)*4;
  data[i]=r; data[i+1]=g; data[i+2]=b; data[i+3]=a;
}

function drawRect(x,y,w,h,r,g,b){
  for(let yy=0;yy<h;yy++){
    for(let xx=0;xx<w;xx++){
      setPixel(x+xx,y+yy,r,g,b);
    }
  }
}

function drawPlayer(){
  drawRect(player.x, player.y, player.width, player.height, ...player.color);
}

function update(){
  const speed = 1;
  if(keys["w"]) player.y-=speed;
  if(keys["s"]) player.y+=speed;
  if(keys["a"]) player.x-=speed;
  if(keys["d"]) player.x+=speed;
}

function loop(){
  clearBuffer();
  update();
  drawPlayer();
  gameCtx.putImageData(buffer,0,0);

  // --- integer scaling, only two bars ---
  const scaleX = Math.floor(screenCanvas.width / GAME_WIDTH);
  const scaleY = Math.floor(screenCanvas.height / GAME_HEIGHT);
  const scale = Math.min(scaleX, scaleY);

  const drawWidth = GAME_WIDTH * scale;
  const drawHeight = GAME_HEIGHT * scale;

  // center on axis with leftover space
  const offsetX = (screenCanvas.width - drawWidth)/2;
  const offsetY = (screenCanvas.height - drawHeight)/2;

  // Fill the two bars only (top/bottom or left/right)
  screenCtx.fillStyle = "#222";
  if(drawWidth < screenCanvas.width){
    // vertical bars
    screenCtx.fillRect(0,0,offsetX,screenCanvas.height); // left
    screenCtx.fillRect(offsetX+drawWidth,0,offsetX,screenCanvas.height); // right
  } else if(drawHeight < screenCanvas.height){
    // horizontal bars
    screenCtx.fillRect(0,0,screenCanvas.width,offsetY); // top
    screenCtx.fillRect(0,offsetY+drawHeight,screenCanvas.width,offsetY); // bottom
  }

  // Draw scaled game
  screenCtx.drawImage(gameCanvas,0,0,GAME_WIDTH,GAME_HEIGHT,offsetX,offsetY,drawWidth,drawHeight);

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
